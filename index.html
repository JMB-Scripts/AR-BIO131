<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code AR Viewer</title>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        model-viewer {
            width: 100%;
            height: 500px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>QR Code AR Viewer</h1>
    <div id="instruction">Click on the cube at the bottom right of the screen to download the model.</div>
    <model-viewer id="ar-model-viewer" 
                  src="" 
                  ios-src="" 
                  alt="A 3D model" 
                  auto-rotate 
                  camera-controls 
                  ar
                  camera-orbit="45deg 55deg 2.5m"
                  exposure="1.5"
                  environment-image="neutral"
                  ar-modes="scene-viewer quick-look webxr" 
                  ar-scale="fixed">
    </model-viewer>
    <script>
        // Function to detect platform and set appropriate model source
        function setModelSource(modelId) {
            const modelViewer = document.getElementById('ar-model-viewer');
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;

            // Base URLs for models on GitHub
            const baseIOSUrl = 'https://github.com/JMB-Scripts/AR-Structural-Biology/raw/main/IOS/';
            const baseAndroidUrl = 'https://github.com/JMB-Scripts/AR-Structural-Biology/raw/main/Android/';

            // Define model filenames
            const models = {
                model1: {
                    ios: 'a-helix.usdz',
                    android: 'a-helix.glb'
                },
                model2: {
                    ios: 'beta-sheet.usdz',
                    android: 'beta-sheet.glb'
                },
                model3: {
                    ios: 'DNA.usdz',
                    android: 'DNA.glb'
                },
                model4: {
                    ios: 'mcherry.usdz',
                    android: 'mcherry.glb'
                },
                model99: {
                    ios: 'cube-test.usdz',
                    android: 'cube-test.glb'
                }
            };

            // Check if the modelId is valid
            if (!models[modelId]) {
                console.error('Invalid model ID:', modelId);
                return;
            }

            // Set the model source based on the platform
            if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
                modelViewer.setAttribute('src', '');
                modelViewer.setAttribute('ios-src', baseIOSUrl + models[modelId].ios);
            } else {
                modelViewer.setAttribute('src', baseAndroidUrl + models[modelId].android);
                modelViewer.setAttribute('ios-src', '');
            }

            // Log to console for debugging
            console.log('Model ID:', modelId);
            console.log('User Agent:', userAgent);
            console.log('Model URL:', modelViewer.getAttribute('src'));
        }

        // Parse model ID from query parameters
        const urlParams = new URLSearchParams(window.location.search);
        const modelId = urlParams.get('model');

        // Set the model source based on the model ID
        setModelSource(modelId);
    </script>
</body>
</html>
